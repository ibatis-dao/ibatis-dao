<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="fxapp01.dao.ProductRefsMapper">
    <resultMap type="ProductRefs" id="ProductRefsMap">
        <id column="ID" property="id" jdbcType="BIGINT"/>
        <result column="NAME" property="name"/>
    </resultMap>

    <select id="select" databaseId="postgresql" parameterType="IntRange" resultMap="ProductRefsMap">
    select "id", "name" 
      from public."test02" 
     order by "id" 
    offset #{first} limit #{length}
    </select>

    <select id="select" databaseId="oracle" parameterType="IntRange" resultMap="ProductRefsMap">
    with t001 as (
            select i.id, 
                   i.name
              from lisa.tmp$items i 
             order by i.id
          )
    select id, name
      from (
        select rownum as rn, 
               id, 
               name
          from t001
      )
     where rn between #{first} and #{last}
    </select>

    <select id="selectByID" databaseId="oracle" parameterType="BigInteger" resultMap="ProductRefsMap">
    select i.id, i.name
      from lisa.tmp$items i
     where i.id = #{id}
    </select>
    
    <select id="selectByID" databaseId="postgresql" parameterType="BigInteger" resultMap="ProductRefsMap">
    select id, 
           name 
      from public."test02"
     where id = #{id}
    </select>
    
    <select id="selectCount" databaseId="oracle" resultType="BigInteger">
    select count(i.id) from lisa.tmp$items i
    </select>
    
    <select id="selectCount" databaseId="postgresql" resultType="BigInteger">
    select count(id) from public."test02"
    </select>
    
    <select id="selectBE" databaseId="postgresql" parameterType="ProductRefsQBE" resultMap="ProductRefsMap">
    select "id", "name" 
      from public."test02" 
        <where>
            <if test="example.id != null and example.id != 0">
                id = #{example.id}
            </if>
            <if test="example.name != null">
                AND name like '%'||#{example.name}||'%'
            </if>
        </where>
        <if test="(sortOrder != null) and (!sortOrder.toString().isEmpty())">
        order by ${sortOrder}
        </if>
    offset #{rowsRange.first} limit #{rowsRange.length}
    </select>

    <insert id="insertRow" databaseId="oracle" statementType="CALLABLE" parameterType="ProductRefs">
    begin 
      insert into lisa.tmp$items(id, name) 
      values (tmp$items_sq.nextval, #{name})
      returning id into #{id,mode=OUT,jdbcType=BIGINT}; 
    end;
    </insert>
    
    <insert id="insertRowBySP" databaseId="oracle" statementType="CALLABLE" parameterType="ProductRefs">
    begin 
      TMP$ITEMS_PKG.insertData(#{id,mode=INOUT,jdbcType=BIGINT}, #{name,mode=INOUT,jdbcType=VARCHAR});
    end;
    </insert>
    
    <insert id="insertRow" databaseId="postgresql" useGeneratedKeys="true" keyProperty="id" parameterType="ProductRefs">
    insert into test02 (id, name) 
    values (DEFAULT, #{name})
    </insert>

    <select id="insertRowBySP" databaseId="postgresql" statementType="CALLABLE" parameterType="ProductRefs" resultMap="ProductRefsMap">
    select * from test02_insertrow(#{id}, #{name}) as t2;
    </select>

    <select id="insertRowBySP2" databaseId="postgresql" statementType="CALLABLE" parameterType="ProductRefs" resultMap="ProductRefsMap">
    select * from test02_insertrow2(ROW(#{id}, #{name})::test02) as t2;
    </select>
    <!--  

select * from test02_insertrow(#{id}, #{name}) as t2;    
select * from test02_insertrow(#{id,mode=IN,javaType=BigInteger,jdbcType=BIGINT}, #{name,mode=IN,jdbcType=VARCHAR}) as t2;
    -->
</mapper>